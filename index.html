<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Internal Access Portal</title>

    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: "Hiragino Mincho ProN","MS Mincho",serif;
            background: #000;
            color: #cccccc;
            min-height: 100vh;
            padding: 20px;
            overflow-x: hidden;
        }

        /* 背景ノイズ */
        body::before {
            content: "";
            position: fixed;
            inset: 0;
            background:
                repeating-linear-gradient(
                    to bottom,
                    rgba(0,255,255,0.05) 0px,
                    rgba(0,255,255,0.05) 1px,
                    rgba(0,0,0,0) 2px
                );
            opacity: 0.08;
            pointer-events: none;
            z-index: 0;
        }

        /* コードスクロール */
        .code-rain {
            position: fixed;
            inset: 0;
            pointer-events: none;
            z-index: 1;
            font-family: "Courier New", monospace;
            font-size: 0.85rem;
            opacity: 0.06;
            white-space: pre;
            color: #00ffff;
            animation: scrollCode 14s linear infinite;
        }

        @keyframes scrollCode {
            0% { transform: translateY(0); }
            100% { transform: translateY(-100%); }
        }

        .header {
            text-align: center;
            border-bottom: 1px solid rgba(0,255,255,0.1);
            padding-bottom: 20px;
            margin-bottom: 30px;
            position: relative;
            z-index: 5;
        }

        .title {
            font-size: 1.6rem;
            color: #e6e6e6;
            letter-spacing: 0.12em;
            text-shadow: 0 0 10px rgba(0,255,255,0.2);
        }

        .subtitle {
            color: #8fa1a1;
            font-size: 0.9rem;
            margin-top: 10px;
        }

        .image-container {
            columns: 5;
            column-gap: 15px;
            z-index: 5;
            position: relative;
        }

        .image-item {
            break-inside: avoid;
            margin-bottom: 15px;
            border: 1px solid #223;
            cursor: pointer;
            background: #111;
            transition: border-color .2s;
        }
        .image-item:hover { border-color: #0aa; }
        .image-item.selected { border-color: #ff0044; border-width: 2px; }

        .image-placeholder {
            width: 100%;
            aspect-ratio: var(--aspect-ratio);
            background: #1b1b1b;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.75rem;
            color: #666;
        }

        .image-placeholder img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .submit-container {
            text-align: center;
            border-top: 1px solid rgba(0,255,255,0.08);
            padding-top: 20px;
            margin-top: 20px;
        }

        .submit-btn {
            background: rgba(0,30,30,0.8);
            border: 1px solid rgba(0,255,255,0.2);
            color: #cde;
            padding: 12px 40px;
            font-size: 0.95rem;
            letter-spacing: 0.15em;
            cursor: pointer;
            opacity: 0.4;
            pointer-events: none;
            transition: .3s;
        }
        .submit-btn.active {
            opacity: 1;
            pointer-events: auto;
        }
        .submit-btn.active:hover {
            background: rgba(0,255,255,0.15);
            box-shadow: 0 0 14px rgba(0,255,255,0.3);
        }

        .message-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.8);
            z-index: 900;
            display: none;
        }
        .message-box {
            position: fixed;
            top: 50%; left: 50%;
            transform: translate(-50%,-50%);
            background: #111;
            border: 1px solid #044;
            padding: 30px;
            text-align: center;
            z-index: 901;
            min-width: 280px;
            color: #cde;
        }

        .message-btn {
            margin-top: 15px;
            padding: 10px 35px;
            background: #022;
            border: 1px solid #0aa;
            color: #cde;
            cursor: pointer;
        }

        /* ✅大型グリッチ演出 */
        .glitch {
            display: none;
            position: fixed;
            inset: 0;
            background: repeating-linear-gradient(
                to bottom,
                rgba(0,255,255,0.5) 0px,
                rgba(0,0,0,0.7) 4px
            );
            z-index: 9999;
            animation: glitchFlash .12s steps(2) infinite;
        }

        @keyframes glitchFlash {
            50% {
                opacity: .4;
                transform: translateX(15px);
            }
        }
    </style>
</head>
<body>

    <div class="code-rain" id="codeRain"></div>

    <div class="header">
        <h1 class="title">Liminal Space脱出口生成フォーム</h1>
        <p class="subtitle">ドアの写真を選択してください</p>
    </div>

    <div class="image-container" id="imageContainer"></div>

    <div class="submit-container">
        <button class="submit-btn" id="submitBtn">送信</button>
    </div>

    <div class="message-overlay" id="messageOverlay">
        <div class="message-box" id="messageBox">
            <div id="messageTitle"></div>
            <div id="messageContent" style="margin-top:8px;"></div>
            <button class="message-btn" id="messageBtn"></button>
        </div>
    </div>

    <div class="glitch" id="glitchScreen"></div>

    <script>
        /* ==== ランダムコード生成 ==== */
        const codeArea = document.getElementById("codeRain");
        const chars = "ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789#%$&@";
        let scrollText = "";
        for (let y = 0; y < 35; y++) {
            let line = "";
            for (let x = 0; x < 80; x++) {
                line += chars[Math.floor(Math.random() * chars.length)];
            }
            scrollText += line + "\n";
        }
        codeArea.textContent = scrollText;

        /* ==== 既存ゲーム部分 ==== */
        const redirectUrl = "https://hazamashobo.github.io/fin/";
        const imageUrls = Array.from({length:60},(_,i)=>`gazou/${i+1}.jpg`);
        const doorUrl = "gazou/door.jpg";

        let selectedItem = null;
        let gameImages = [];

        function randomRatio(){ return 0.6 + Math.random()*1.4 }

        function createImages(){
            const imgs=[{type:'door',url:doorUrl,aspectRatio:randomRatio()}];
            const rest=[...imageUrls];
            for(let i=1;i<60;i++){
                let url = rest.length ? rest.splice(Math.floor(Math.random()*rest.length),1)[0] : "";
                imgs.push({type:'other',url,aspectRatio:randomRatio()});
            }
            return shuffle(imgs);
        }

        function shuffle(arr){
            for(let i=arr.length-1;i>0;i--){
                const j=Math.floor(Math.random()*(i+1));
                [arr[i],arr[j]]=[arr[j],arr[i]];
            }
            return arr;
        }

        function init(){
            gameImages=createImages();
            const container=document.getElementById('imageContainer');
            container.innerHTML='';
            gameImages.forEach((img,idx)=>{
                const item=document.createElement('div');
                item.className='image-item';
                item.dataset.type=img.type;
                item.dataset.index=idx;

                const ph=document.createElement('div');
                ph.className='image-placeholder';
                ph.style.setProperty('--aspect-ratio',img.aspectRatio);

                if(img.url){
                    const image=document.createElement('img');
                    image.src=img.url;
                    ph.appendChild(image);
                }else{
                    ph.textContent=`IMAGE ${idx}`;
                }

                item.appendChild(ph);
                item.addEventListener('click',select);
                container.appendChild(item);
            })
        }

        function select(e){
            if(selectedItem) selectedItem.classList.remove('selected');
            selectedItem=e.currentTarget;
            selectedItem.classList.add('selected');
            document.getElementById('submitBtn').classList.add('active');
        }

        function submit(){
            if(!selectedItem) return;
            const overlay=document.getElementById('messageOverlay');
            const title=document.getElementById('messageTitle');
            const content=document.getElementById('messageContent');
            const btn=document.getElementById('messageBtn');

            overlay.style.display='block';

            if(selectedItem.dataset.type==='door'){
                title.textContent="CORRECT";
                content.textContent="出口を生成します";
                btn.textContent="桐須を助ける";
                btn.onclick=function(){
                    startGlitch();
                    setTimeout(()=>window.location.href=redirectUrl, 1000);
                };
            }else{
                title.textContent="ERROR";
                content.textContent="出口ではありません";
                btn.textContent="戻る";
                btn.onclick=()=>overlay.style.display='none';
            }
        }

        function startGlitch(){
            document.getElementById('glitchScreen').style.display="block";
        }

        document.getElementById('submitBtn').onclick=submit;

        init();
    </script>

</body>
</html>
